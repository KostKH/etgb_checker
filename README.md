# etgb_checker

`etgb_checker` - это REST-API сервиса получения таможенных деклараций ETGB Озона с ендпойнта https://api-seller.ozon.ru/v1/posting/global/etgb.

Вы отправляете на API данного сервиса запрос с данными Client-ID и API-key Озона, и сервис присваевает вашему запросу Query-ID, отправляет этот Query-ID вам в теле ответа, делает запрос на API Озона и полученные декларации сохраняет в БД Clickhouse. Запрос на API Озона отправляется в отдельном потоке, поэтому для получения информации об итогах вашего запроса нужно обратиться к ендпойнту /etgb/{Query-ID}/.

Информация о самих декларациях через данное API не передается, эти данные вы можете взять из БД Clickhouse (предполагается, что у вас есть к ней доступ).

Многопоточность приложения достигается путем использования Gunicorn.

## Ендпойнты сервиса

Были созданы следущие ендпойнты:

```
/etgb/ - отправка запроса на получение (POST)
/etgb/{Query-ID}/ - получение информации о статусе отправленного запроса (GET)
/redoc/ - Подробная документация по данному API
```
Примеры запросов и ответов API можно увидеть, обратившись к ендпойнту /redoc/

## Системные требования
- Python 3.11+
- Works on Linux, Windows, macOS

## Технологии:
- Python 3.11
- Flask
- Clickhouse
- SQLite
- Celery 
- RabbitMQ
- Gunicorn
- Docker & Docker compose

## Как запустить проект:

Для запуска в проект вложена конфигурация docker compose. После запуска docker compose API будет доступно по адресу: `http://<host address>:5000/`

Необходимо выполнить следующие шаги:
- Склонируйте репозиторий с GitHub и перейдите в папку проекта, где расположен файл docker-compose.yml:

```
git clone https://github.com/KostKH/dating_app.git
cd dating_app/infra_dating/
```

- Проверьте, что на машине / сервере установлены `docker` и `docker compose`

- Cоздайте в папке `infra_etgb` файл `.env` с переменными окружения. Можно создать его из вложенного образца `env_example.env`:
```
cp env_example.env .env
```
- Откройте файл .env в редакторе и поменяйте, при необходимости, переменные окружения. При этом обязательно поменяйте пароли к БД и брокеру сообщений RabbitMQ.

- Установите и запустите приложение в контейнере. (Возможно, вам придется добавить `sudo` перед текстом команды):
```
docker compose up -d
```
- Запустите команду для создания таблиц в базах данных:
```
docker-compose exec app python create_tables.py
```

## О программе:

Автор: Константин Харьков
